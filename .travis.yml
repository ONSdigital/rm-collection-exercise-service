sudo: required

services:
  - docker

language: java
jdk: openjdk8

before_install:
  - cp .maven.settings.xml $HOME/.m2/settings.xml
  - mvn fmt:check
  - docker login -u "${DOCKER_GCP_USERNAME}" -p "${DOCKER_GCP_PASSWORD}" "${DOCKER_GCP_REGISTRY}";

install: mvn install -DskipTests -DskipITs -Ddocker.skip -Ddockerfile.skip -Dmaven.javadoc.skip=true -Dhttp.wait.skip -B -V
script: mvn verify cobertura:cobertura-integration-test

after_success:
  - if [ "$TRAVIS_BRANCH" == "rm-census" ] && [ "$TRAVIS_PULL_REQUEST" == "false" ] ; then
    docker login -u "${DOCKER_GCP_USERNAME}" -p "${DOCKER_GCP_PASSWORD}" "${DOCKER_GCP_REGISTRY}";
    docker push "eu.gcr.io/census-rm-ci/rm/census-rm-collectionexercisesvc";
    fi
  - bash <(curl -s https://codecov.io/bash)

cache:
  directories:
    - $HOME/.m2


branches:
  only:
    - rm-census
